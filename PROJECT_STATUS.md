# é¡¹ç›®çŠ¶æ€æ€»ç»“

## âœ… å·²å®ŒæˆåŠŸèƒ½ï¼ˆæ›´æ–°è‡³ 2025-10-05ï¼‰

### æ ¸å¿ƒæ¸¸æˆç³»ç»Ÿ
- **ç©å®¶æ³¨å†Œä¸åŒæ­¥** (`/api/sync`) - æ­£å¸¸è¿è¡Œ
- **ç©å®¶ç§»åŠ¨** (`/api/move`) - æ­£å¸¸è¿è¡Œ
- **èµ„æºé‡‡é›†** (`/api/collect`) - æ­£å¸¸è¿è¡Œ
- **åŸºåœ°å»ºè®¾** (`/api/base/build`, `/api/base/set_home`) - æ­£å¸¸è¿è¡Œ
- **åœ°å›¾æ‰«æ** (`/api/map/scan`) - æ­£å¸¸è¿è¡Œ
- **ç®¡ç†å‘˜å·¥å…·** (`/api/admin/seed`, `/api/admin/config`, `/api/admin/preview-weapon`) - æ­£å¸¸è¿è¡Œ

### æ­¦å™¨ç³»ç»Ÿï¼ˆæ–°å¢ & å·²è¿­ä»£ï¼‰âœ¨
- **æ­¦å™¨ç”Ÿæˆ** (`/api/weapon/generate`) - âœ… å®Œå…¨å®ç°å¹¶å·²å¢å¼º
  - åŸæœ‰åº•æã€è¯ç¼€ã€å“è´¨é€»è¾‘ä¿ç•™ã€‚
  - ç°åœ¨è¿è¡Œæ—¶ä»£ç ä¼šè¯»å– `data/weapon-config.json`ï¼ˆæ”¯æŒå¤šçº§å€™é€‰è·¯å¾„ï¼‰ï¼Œadmin é¡µé¢å¯¹é…ç½®çš„ä¿®æ”¹å¯å³æ—¶ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯æœåŠ¡ã€‚
- **æ­¦å™¨ç®¡ç†** (`/api/weapon/add`, `/api/weapon/inventory`) - âœ… å®Œå…¨å®ç°
  - æ·»åŠ æ­¦å™¨åˆ°ç©å®¶èƒŒåŒ…ã€æŸ¥çœ‹èƒŒåŒ…åˆ—è¡¨ã€æ—¶é—´æˆ³ä¸å±æ€§å±•ç¤ºæ­£å¸¸
- **ç³»ç»Ÿä¿¡æ¯** (`/api/weapon/info`) - âœ… å®Œå…¨å®ç°
  - è¿”å›å½“å‰é…ç½®æ•°æ®ï¼Œä¾¿äºå‰ç«¯è°ƒè¯•å’ŒéªŒè¯

### ç®¡ç†åå° / é™æ€èµ„æº
- `public/admin.html` ï¼ˆç®¡ç†åå°ï¼‰å·²å®Œæˆï¼Œæ”¯æŒï¼šåŠ è½½/ä¿å­˜ `weapon-config.json`ã€é¢„è§ˆç”Ÿæˆæ­¦å™¨ã€å¢åˆ åº•æ/è¯ç¼€/å“è´¨ã€‚
- å·²ç¡®ä¿é™æ€èµ„æºå¯ç”±æœ¬åœ° `vercel dev` æ­£ç¡®æä¾›ï¼ˆå·²å°† `public/` æ”¾ç½®äº `servercode/` ä¸‹ä»¥åŒ¹é…äº‘ç«¯é¡¹ç›®æ ¹é…ç½®ï¼‰ã€‚

## ğŸ“Š æœ€è¿‘ä¿®å¤ä¸æ”¹è¿›è¦ç‚¹
- ä¿®å¤æœ¬åœ° Vercel CLI é™æ€æ–‡ä»¶ 404 é—®é¢˜ï¼šå°† `public/` ç§»åŠ¨åˆ° `servercode/public/`ï¼ˆä¸äº‘ç«¯ Root Directory å¯¹é½ï¼‰ï¼Œå¹¶å¤‡ä»½/æ¸…ç†æœ¬åœ° `.vercel` å…ƒæ•°æ®ä»¥é¿å…æ—§ç»‘å®šå¹²æ‰°ã€‚
- ä¿®å¤ç©ºæˆ–æŸåçš„ `vercel.json`ï¼ˆåˆ é™¤æˆ–é‡ç½®ä¸ºç©ºå¯¹è±¡ï¼‰ï¼Œé¿å…å¯åŠ¨æ—¶æŠ¥é”™å’Œé‡å»ºè§¦å‘ã€‚
- æ­¦å™¨ç”Ÿæˆå™¨ `generate.js` å·²æ”¹ä¸ºè¿è¡Œæ—¶è¯»å– `data/weapon-config.json`ï¼ˆå°è¯•å¤šçº§è·¯å¾„ï¼‰ï¼Œå› æ­¤é€šè¿‡ admin ä¿å­˜çš„ä¿®æ”¹ä¼šç«‹åˆ»è¢«é‡‡æ ·ã€‚
- åœ¨ `servercode/` å®‰è£…ä¾èµ–ï¼Œå‡å°‘ builder åœ¨è¯·æ±‚æ—¶é‡å¤å®‰è£…å¯¼è‡´çš„è¶…æ—¶/é‡å¯é—®é¢˜ï¼ˆå·²æ‰§è¡Œ `npm install`ï¼‰ã€‚
- è§£å†³äº†å› æœ¬åœ° .vercel æŒ‡å‘å­ç›®å½•å¯¼è‡´çš„è·¯å¾„æ‹¼æ¥é”™è¯¯ï¼ˆå¦‚å‡ºç° `servercode/servercode`ï¼‰çš„é—®é¢˜ï¼šå·²ä½¿ç”¨ `vercel link` æˆ–å¤‡ä»½æœ¬åœ° .vercel å¹¶åœ¨æ­£ç¡®ç›®å½•å¯åŠ¨ devã€‚

## ğŸ›  æŠ€æœ¯æ¶æ„ï¼ˆç®€è¦ï¼‰
```
servercode/                # Vercel é¡¹ç›®æ ¹ï¼ˆäº‘ç«¯é…ç½®ï¼‰
â”œâ”€â”€ api/                   # æ‰€æœ‰ serverless å‡½æ•°
â”‚   â”œâ”€â”€ admin/             # ç®¡ç†ç›¸å…³æ¥å£ï¼ˆconfig, preview-weapon, seedï¼‰
â”‚   â”œâ”€â”€ weapon/            # weapon: generate, add, inventory, info
â”‚   â””â”€â”€ ...
â”œâ”€â”€ public/                # é™æ€èµ„æºï¼ˆadmin.html, test.txtï¼‰
â””â”€â”€ package.json

data/                      # å…¨å±€å¯å†™é…ç½®ï¼ˆä½äºä»“åº“æ ¹ï¼‰
â””â”€â”€ weapon-config.json     # ç®¡ç†åå°ç¼–è¾‘å¹¶æŒä¹…åŒ–çš„é…ç½®
``` 

è¯´æ˜ï¼š`generate.js` ä¼šåœ¨è¿è¡Œæ—¶å°è¯•è¯»å–å¤šçº§å€™é€‰è·¯å¾„çš„ `weapon-config.json`ï¼ˆä¾‹å¦‚ `servercode/../data/weapon-config.json`ï¼‰ï¼Œå› æ­¤æ— éœ€å°†é…ç½®æ–‡ä»¶å¼ºåˆ¶ç§»åŠ¨åˆ° `servercode/` ä¸‹ã€‚

## ğŸš€ æœ¬åœ°å¼€å‘ä¸å¿«é€ŸéªŒè¯ï¼ˆå½“å‰æ¨èæµç¨‹ï¼‰
- æ¨èåœ¨ `servercode/` ä¸‹è¿è¡Œæœ¬åœ° devï¼ˆä¸äº‘ç«¯é¡¹ç›®æ ¹ä¸€è‡´ï¼‰ï¼š

```bash
# åœ¨ bash (Windows) ä¸‹æ‰§è¡Œ
cd /e/VercelWorkPath/server/servercode
# ç¡®ä¿ä¾èµ–å·²å®‰è£…ï¼ˆå·²æ‰§è¡Œè¿‡ä¸€æ¬¡ï¼‰
npm install
# å¯åŠ¨ vercel devï¼ˆdebug å¯é€‰ï¼‰
vercel dev --debug
```

- éªŒè¯é™æ€ä¸ APIï¼š
  - é™æ€ï¼š http://localhost:3000/test.txt  å’Œ  http://localhost:3000/admin.html
  - é¢„è§ˆæ¥å£ï¼š
    curl -v -X POST http://localhost:3000/api/admin/preview-weapon -H 'Content-Type: application/json' -d '{"playerLevel":10}'
  - ç”Ÿæˆæ¥å£ï¼š
    curl -v -X POST http://localhost:3000/api/weapon/generate -H 'Content-Type: application/json' -d '{"playerLevel":10}'
  - é…ç½®æ¥å£ï¼ˆç®¡ç†åå°ä¿å­˜åå¯ç”¨ï¼‰ï¼š
    curl -v http://localhost:3000/api/admin/config

## âœ… éªŒè¯è¦ç‚¹ï¼ˆå¦‚æœä½ é‡åˆ°â€œé…ç½®ä¸ç”Ÿæ•ˆâ€ï¼‰
1. åœ¨ç®¡ç†åå°ä¿å­˜åï¼Œç¡®è®¤ `/api/admin/config` è¿”å›çš„æ–°å†…å®¹ï¼š
   curl -v http://localhost:3000/api/admin/config
2. ç›´æ¥ç”¨ç”Ÿæˆæ¥å£å¤šæ¬¡è°ƒç”¨éªŒè¯æ ·æœ¬æ˜¯å¦å‡ºç°æ–°åº•æï¼š
   for i in {1..50}; do curl -s -X POST http://localhost:3000/api/weapon/generate -H 'Content-Type: application/json' -d '{"playerLevel":10}' | jq .data.weapon.base.baseId; done
3. è‹¥æœªå‡ºç°ï¼šç¡®è®¤ `data/weapon-config.json` æ˜¯å¦åŒ…å«ä½ æ·»åŠ çš„åº•æï¼ˆæ–‡ä»¶è·¯å¾„ä¸ºä»“åº“æ ¹çš„ `data/weapon-config.json`ï¼‰ï¼Œæˆ–åœ¨ `servercode/data/weapon-config.json`ï¼ˆè‹¥ä½ ç§»åŠ¨è¿‡ï¼‰ä¸­ä¹Ÿå­˜åœ¨ã€‚

## åç»­å»ºè®®
- è‹¥å¸Œæœ›å®Œå…¨é¿å…è·¯å¾„æ­§ä¹‰ï¼Œå¯æŠŠ `data/weapon-config.json` åŒæ­¥å¤åˆ¶åˆ° `servercode/data/weapon-config.json`ï¼ˆæˆ–åœ¨éƒ¨ç½²æ—¶æŠŠ data ä½œä¸ºéƒ¨ç½²èµ„æºï¼‰ã€‚
- å°†ç®¡ç†åå°å•å…ƒæµ‹è¯•åŒ–ï¼ˆä¾‹å¦‚å¯¹ `/api/admin/config` ä¸ `/api/weapon/generate` ç¼–å†™é›†æˆæµ‹è¯•ï¼‰ä»¥é¿å…è¿è¡Œæ—¶é…ç½®ä¸åŒæ­¥é—®é¢˜ã€‚

## ğŸ¯ å½“å‰é¡¹ç›®å®Œæˆåº¦ï¼šçº¦ 95%ï¼ˆå·²å¯ç»§ç»­è¿›å…¥ç”Ÿäº§éƒ¨ç½²æˆ–å¢åŠ æ–°åŠŸèƒ½ï¼‰
- æ ¸å¿ƒé€»è¾‘ã€ç®¡ç†é¡µé¢ã€è¿è¡Œæ—¶é…ç½®å’Œæœ¬åœ° dev æµç¨‹å·²ç¨³å®šã€‚
